<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard Hệ Thống - Manager</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="stylesheet" href="/accounts/css/stats.css">
</head>

<body>
        <div class="container-fluid">
                <!-- Header Section -->
                <div class="header-section animate-fade-in">
                        <h1><i class="fas fa-chart-line"></i> Dashboard Hệ Thống</h1>
                        <p class="lead">Quản lý và theo dõi hiệu suất toàn hệ thống</p>
                </div>

                <!-- Period Selector -->
                <div class="period-selector animate-fade-in">
                        <button class="btn period-btn" th:classappend="${currentPeriod == 'week'} ? 'active' : ''"
                                onclick="changePeriod('week')">
                                <span>7 ngày</span>
                        </button>
                        <button class="btn period-btn" th:classappend="${currentPeriod == 'month'} ? 'active' : ''"
                                onclick="changePeriod('month')">
                                <span>30 ngày</span>
                        </button>
                        <button class="btn period-btn" th:classappend="${currentPeriod == 'quarter'} ? 'active' : ''"
                                onclick="changePeriod('quarter')">
                                <span>3 tháng</span>
                        </button>
                        <button class="btn period-btn" th:classappend="${currentPeriod == 'year'} ? 'active' : ''"
                                onclick="changePeriod('year')">
                                <span>1 năm</span>
                        </button>
                </div>

                <!-- Alert -->
                <div class="alert animate-fade-in" role="alert">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Thông Báo Quan Trọng:</strong>
                        Doanh thu tháng này đã vượt mục tiêu 15%. Cần xem xét mở rộng đội ngũ mentor.
                </div>

                <!-- Main Stats Cards -->
                <div class="row">
                        <div class="col-md-3">
                                <div class="stats-card animate-fade-in">
                                        <h5><i class="fas fa-money-bill-wave"></i> Tổng Doanh Thu Hệ Thống</h5>
                                        <h2 id="totalRevenue"
                                                th:text="${#numbers.formatDecimal(stats.totalRevenue, 0, 'COMMA', 0, 'POINT')} + '₫'">
                                                2,450,000,000₫</h2>
                                        <span class="growth-positive" id="revenueGrowth"
                                                th:text="'+' + ${#numbers.formatDecimal(stats.revenueGrowth, 1, 'COMMA', 1, 'POINT')} + '% so với tháng trước'">+15.2%
                                                so với tháng trước</span>
                                </div>
                        </div>
                        <div class="col-md-3">
                                <div class="stats-card animate-fade-in">
                                        <h5><i class="fas fa-chalkboard-teacher"></i> Tổng Số Mentor</h5>
                                        <h2 id="totalMentors" th:text="${stats.totalMentors}">145</h2>
                                        <span class="growth-positive" id="mentorGrowth"
                                                th:text="'+' + ${stats.mentorGrowth} + ' mentor mới'">+12 mentor
                                                mới</span>
                                </div>
                        </div>
                        <div class="col-md-3">
                                <div class="stats-card animate-fade-in">
                                        <h5><i class="fas fa-users"></i> Tổng Học Viên</h5>
                                        <h2 id="totalStudents"
                                                th:text="${#numbers.formatDecimal(stats.totalStudents, 0, 'COMMA', 0, 'POINT')}">
                                                3,247</h2>
                                        <span class="growth-positive" id="studentGrowth"
                                                th:text="'+' + ${stats.studentGrowth} + ' học viên'">+156 học
                                                viên</span>
                                </div>
                        </div>
                </div>

                <!-- System Overview -->
                <div class="section-header">
                        <h3><i class="fas fa-chart-bar"></i> Tổng Quan Hệ Thống</h3>
                </div>

                <div class="row">
                        <div class="col-md-2">
                                <div class="overview-card">
                                        <h4 id="activeCourses"
                                                th:text="${#numbers.formatDecimal(stats.activeCourses, 0, 'COMMA', 0, 'POINT')}">
                                                1,234</h4>
                                        <p>Khóa Học Hoạt Động</p>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="overview-card">
                                        <h4 id="satisfactionRate" th:text="${stats.satisfactionRate} + '%'">94%</h4>
                                        <p>Độ Hài Lòng</p>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="overview-card">
                                        <h4 id="avgRevenuePerMentor"
                                                th:text="${#numbers.formatDecimal(stats.avgRevenuePerMentor/1000000, 1, 'COMMA', 1, 'POINT')} + 'M₫'">
                                                16.9M₫</h4>
                                        <p>Doanh Thu TB/Mentor</p>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="overview-card">
                                        <h4 id="avgStudentsPerMentor" th:text="${stats.avgStudentsPerMentor}">22</h4>
                                        <p>Học Viên TB/Mentor</p>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="overview-card">
                                        <h4 id="avgRating" th:text="${stats.avgRating} + '⭐'">4.8⭐</h4>
                                        <p>Đánh Giá TB</p>
                                </div>
                        </div>
                </div>

                <!-- Charts Section -->
                <div class="row mt-4">
                        <div class="col-md-8">
                                <div class="card">
                                        <div class="card-header">
                                                <h5><i class="fas fa-chart-line"></i> Doanh Thu Hệ Thống Theo Thời Gian
                                                </h5>
                                        </div>
                                        <div class="card-body">
                                                <div class="chart-container">
                                                        <canvas id="revenueChart"></canvas>
                                                </div>
                                        </div>
                                </div>
                        </div>
                        <div class="col-md-4">
                                <div class="card">
                                        <div class="card-header">
                                                <h5><i class="fas fa-trophy"></i> Top 5 Mentor Theo Doanh Thu</h5>
                                        </div>
                                        <div class="card-body">
                                                <div id="topMentorsList">
                                                        <div class="mentor-item"
                                                                th:each="mentor, iterStat : ${stats.topMentors}">
                                                                <div class="d-flex align-items-center">
                                                                        <span class="badge bg-primary"
                                                                                th:text="${iterStat.count}">1</span>
                                                                        <span th:text="${mentor.mentorName}">Nguyễn Văn
                                                                                A</span>
                                                                </div>
                                                                <strong
                                                                        th:text="${mentor.formattedRevenue}">45,000,000₫</strong>
                                                        </div>
                                                </div>
                                        </div>
                                </div>
                        </div>
                </div>

                <!-- Financial KPIs -->
                <div class="section-header">
                        <h3><i class="fas fa-calculator"></i> Hiệu Suất Tài Chính</h3>
                </div>

                <div class="row">
                        <div class="col-md-2">
                                <div class="kpi-card">
                                        <h5 id="netProfit"
                                                th:text="${#numbers.formatDecimal(stats.netProfit/1000000000, 1, 'COMMA', 1, 'POINT')} + 'B₫'">
                                                1.8B₫</h5>
                                        <p>Lợi Nhuận Ròng</p>
                                        <small class="growth-positive" id="netProfitGrowth"
                                                th:text="'+' + ${stats.netProfitGrowth} + '%'">+12%</small>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="kpi-card">
                                        <h5 id="operatingCost"
                                                th:text="${#numbers.formatDecimal(stats.operatingCost/1000000, 0, 'COMMA', 0, 'POINT')} + 'M₫'">
                                                650M₫</h5>
                                        <p>Chi Phí Vận Hành</p>
                                        <small class="growth-negative" id="operatingCostGrowth"
                                                th:text="${stats.operatingCostGrowth} + '%'">+5%</small>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="kpi-card">
                                        <h5 id="avgROI" th:text="${stats.avgROI} + '%'">276%</h5>
                                        <p>ROI Trung Bình</p>
                                        <small class="growth-positive" id="roiGrowth"
                                                th:text="'+' + ${stats.roiGrowth} + '%'">+18%</small>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="kpi-card">
                                        <h5 id="churnRate" th:text="${stats.churnRate} + '%'">3.2%</h5>
                                        <p>Churn Rate</p>
                                        <small class="growth-negative" id="churnGrowth"
                                                th:text="${stats.churnGrowth} + '%'">-0.5%</small>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="kpi-card">
                                        <h5 id="cac"
                                                th:text="${#numbers.formatDecimal(stats.cac/1000, 0, 'COMMA', 0, 'POINT')} + 'k₫'">
                                                125k₫</h5>
                                        <p>CAC</p>
                                        <small class="growth-positive" id="cacGrowth"
                                                th:text="'+' + ${stats.cacGrowth} + '%'">-8%</small>
                                </div>
                        </div>
                        <div class="col-md-2">
                                <div class="kpi-card">
                                        <h5 id="ltv"
                                                th:text="${#numbers.formatDecimal(stats.ltv/1000000, 1, 'COMMA', 1, 'POINT')} + 'M₫'">
                                                3.4M₫</h5>
                                        <p>LTV</p>
                                        <small class="growth-positive" id="ltvGrowth"
                                                th:text="'+' + ${stats.ltvGrowth} + '%'">+15%</small>
                                </div>
                        </div>
                </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/accounts/js/stats.js"></script>
</body>

</html>