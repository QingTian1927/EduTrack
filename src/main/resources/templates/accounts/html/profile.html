<!DOCTYPE html>
<html lang="vi">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Hồ sơ</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="/accounts/js/profile.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-6 relative">
                <!-- User Avatar in Top-Right Corner -->
                <img id="top-avatar" th:src="@{/avatar/{id}(id=${user.id})}" alt="Avatar"
                        class="absolute top-4 right-4 w-16 h-16 rounded-full object-cover border-2 border-gray-200">
                <h1 class="text-2xl font-bold text-gray-800 mb-6">Hello, <span th:text="${user.fullName}">Username</span></h1>

                <!-- Tab Navigation -->
                <div class="flex border-b border-gray-200 mb-6">
                        <button class="tab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600"
                                onclick="showTab('profile')">Profile</button>
                        <button class="tab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600"
                                onclick="showTab('edit')">Edit</button>
                        <button class="tab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600"
                                onclick="showTab('avatar')">Avatar</button>
                </div>

                <!-- Profile Tab -->
                <div id="profile" class="tab-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                        <h2 class="text-lg font-semibold text-gray-700 mb-4">Personal information</h2>
                                        <p><strong>Email:</strong> <span class="text-gray-600" th:text="${user.email}"></span></p>
                                        <p><strong>Phone:</strong> <span class="text-gray-600" th:text="${user.phone}"></span></p>
                                        <p><strong>Date of birth:</strong> <span th:text="${#dates.format(user.birthDate, 'yyyy-MM-dd')}"></span></p>
                                        <p><strong>Gender:</strong> <span th:text="${user.gender == 'male' ? 'Male' : 'Female'}"></span></p>
                                        <p><strong>Bio:</strong> <span class="text-gray-600" th:text="${user.bio} ?: 'Unsired'"></span></p>
                                </div>
                                <div th:if="${role == 'mentor'}">
                                        <p><strong>Expertise:</strong> <span class="text-gray-600 max-w-full break-words"
                                                        th:text="${mentor.expertise}"></span></p>
                                        <p><strong>Total number of sessions:</strong> <span class="text-gray-600" th:text="${mentor.totalSessions}"></span></p>
                                        <p><strong>Rating:</strong> <span class="text-gray-600" th:text="${mentor.rating}"></span></p>
                                        <p class="mt-4">
                                                <span th:if="${mentor != null and mentor.isAvailable}" class="text-green-600">✅ You are teaching</span>
                                                <span th:unless="${mentor != null and mentor.isAvailable}" class="text-red-600">❌ You are not having any teaching</span>
                                        </p>
                                </div>
                                <div th:if="${role == 'mentee'}">
                                        <p><strong>Interest:</strong> <span class="text-gray-600 max-w-full break-words"
                                                        th:text="${mentee.interests}"></span></p>
                                        <p><strong>Number of sessions:</strong> <span class="text-gray-600" th:text="${mentee.totalSessions}"></span></p>                              
                                </div>
                        </div>
                </div>

                <!-- Edit Tab -->
                <div id="edit" class="tab-content hidden">
                        <form th:action="@{/profile/{id}/edit(id=${user.id})}" method="post" class="space-y-4">
                                <input type="text" name="id" th:value="${user.id}" hidden>
                                <div>
                                        <label class="block text-sm font-medium text-gray-700">Fullname:</label>
                                        <input type="text" name="fullName" th:value="${user.fullName}" required
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                        <label class="block text-sm font-medium text-gray-700">Email:</label>
                                        <input type="email" name="email" th:value="${user.email}" required
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                        <label class="block text-sm font-medium text-gray-700">Phone:</label>
                                        <input type="text" name="phone" th:value="${user.phone}"
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                        <label class="block text-gray-700">Date of birth:</label>
                                        <input type="date" name="birthDate" th:value="${#dates.format(user.birthDate, 'yyyy-MM-dd')}"
                                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">              
                                </div>
                                <div>
                                        <label class="block text-sm font-medium text-gray-700">Bio:</label>
                                        <textarea name="bio" th:text="${user.bio}"
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                        </textarea>
                                </div>
                                <div th:if="${role == 'mentor'}">
                                        <label class="block text-sm font-medium text-gray-700">Expertise:</label>
                                        <textarea name="expertise" th:text="${mentor.expertise}"
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                        </textarea>
                                </div>
                                <div th:if="${role == 'mentee'}">
                                        <label class="block text-sm font-medium text-gray-700">Interest:</label>
                                        <textarea name="interests" th:text="${mentee.interests}"
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                        </textarea>
                                </div>
                                <button type="submit"
                                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save Information</button>
                        </form>
                </div>

                <!-- Avatar Tab -->
                <div id="avatar" class="tab-content hidden">
                        <form th:action="@{/upload/{id}(id=${user.id})}" method="post" enctype="multipart/form-data"
                                class="flex flex-col items-center space-y-4" onsubmit="return validateImage()">
                                <img id="avatar-preview" th:src="@{/avatar/{id}(id=${user.id})}" alt="Avatar"
                                        class="w-32 h-32 rounded-full object-cover border-2 border-gray-200">
                                <input type="file" id="avatar-input" name="image" accept="image/*" class="mt-2 text-sm text-gray-600"
                                        required onchange="checkFileType()">
                                <p id="file-error" class="text-red-600 text-sm hidden">Only allow image format (.jpg, .png, .jpeg, .gif, ...)</p>
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                        Avatar update
                                </button>
                        </form>
                </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script th:if="${error}">
                Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: '[[${error}]]'
                });
        </script>
        <script>
                function checkFileType() {
                        const input = document.getElementById('avatar-input');
                        const error = document.getElementById('file-error');
                        const file = input.files[0];

                        if (!file) {
                                error.classList.add('hidden');
                                return;
                        }

                        // Kiểm tra MIME type
                        if (!file.type.startsWith('image/')) {
                                error.classList.remove('hidden');
                                input.value = "";  // Reset file
                        } else {
                                error.classList.add('hidden');
                        }
                }

                function validateImage() {
                        const input = document.getElementById('avatar-input');
                        const error = document.getElementById('file-error');

                        if (!input.files || input.files.length === 0) {
                                alert("Please choose a picture.");
                                return false;
                        }

                        if (!input.files[0].type.startsWith('image/')) {
                                error.classList.remove('hidden');
                                alert("The file is invalid. Please choose a picture.");
                                return false;
                        }

                        return true;
                }
           </script>
</body>

</html>