<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduTrack - Feedback List</title>
    <link rel="stylesheet" th:href="@{/css/master.css}"/>
    <link rel="stylesheet" th:href="@{/css/colors.css}"/>

    <style>
        .page-header { font-size: 2.5em; padding: 0.5rem; margin-bottom: 0.5rem; }
        .main-grid { display: grid; grid-template-columns: 1fr; gap: 1em; padding: 0.5em; }
        .filter-form { display: grid; grid-template-columns: 1fr 1fr auto; grid-template-rows: auto auto; gap: 1em; }
        .filter-group { display: flex; justify-content: flex-start; gap: 0.5em; }
        .feedback-table { width: 100%; border-collapse: collapse; }
        .feedback-table-header { background-color: var(--color-primary); }
        .feedback-table th, .feedback-table td { padding: 0.5em; border: 1px solid var(--color-secondary); text-align: left; }
        .feedback-table tbody > tr:nth-child(odd) { background-color: var(--bg-primary); }
        .feedback-table tbody > tr:nth-child(even) { background-color: var(--bg-modal); }
        .bg-active { background-color: var(--color-success); }
        .bg-hidden { background-color: var(--color-error); }
        .pagination { width: 100%; display: flex; justify-content: center; gap: 0.5em; }
        .visible { visibility: visible; }
        .invisible { visibility: hidden; }
    </style>
</head>
<body class="viewport">
<h1 class="page-header">Feedback / Review List</h1>
<main class="main-grid">
    <form class="filter-form" id="filter-form" th:action="@{/admin/reviews/list/1}" method="get">
        <div class="filter-group">
            <label for="sort">Sorting Order:</label>
            <select name="sort" id="sort">
                <option value="date-desc" th:selected="${sort != null && sort == 'date-desc'}">Date descending</option>
                <option value="date-asc" th:selected="${sort != null && sort == 'date-asc'}">Date ascending</option>
                <option value="rating-desc" th:selected="${sort != null && sort == 'rating-desc'}">Rating descending</option>
                <option value="rating-asc" th:selected="${sort != null && sort == 'rating-asc'}">Rating ascending</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Status:</label>
            <label for="active">
                <input type="radio" name="status" id="active" value="ACTIVE"
                       th:checked="${status != null and status == 'ACTIVE'}"> Active
            </label>
            <label for="hidden">
                <input type="radio" name="status" id="hidden" value="HIDDEN"
                       th:checked="${status != null and status == 'HIDDEN'}"> Hidden
            </label>
            <label>
                <input type="radio" name="status" value="" th:checked="${status == null or status == ''}"> All
            </label>
        </div>
        <button type="submit">Filter</button>
    </form>

    <table class="feedback-table">
        <thead class="feedback-table-header">
        <tr>
            <th>Status</th>
            <th>Created Date</th>
            <th>Mentee</th>
            <th>Mentor</th>
            <th>Course</th>
            <th>Rating</th>
            <th style="width: 40%;">Content</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="fb : ${page.content}">
            <td th:text="${fb.status.name()}" th:classappend="${fb.status.name() == 'ACTIVE' ? 'bg-active' : 'bg-hidden'}"></td>
            <td th:text="${#temporals.format(fb.createdDate, 'yyyy-MM-dd')}"></td>
            <td th:text="${fb.mentee.fullName}"></td>
            <td th:text="${fb.courseMentor.mentor.fullName}"></td>
            <td th:text="${fb.courseMentor.course.name}"></td>
            <td>
                <span th:text="${fb.rating}">5.0</span>
            </td>
            <td th:text="${fb.content}"></td>
            <td>
                <!-- Toggle Status Link -->
                <a th:href="@{|/admin/reviews/toggle-status/${fb.id}|}">
                    <span th:text="${fb.status.name() == 'ACTIVE' ? 'Hide' : 'Activate'}"></span>
                </a>
                <br/>
                <!-- Delete Link -->
                <a th:href="@{|/admin/reviews/delete/${fb.id}|}"
                   th:onclick="'return confirm(\'Are you sure you want to delete this feedback?\');'">
                    Delete
                </a>

            </td>
        </tr>
        </tbody>
    </table>

    <div class="pagination">
        <button id="first-page" th:classappend="${(pageNumber > 1) ? 'visible' : 'invisible'}">First</button>
        <button id="previous-page" th:classappend="${(page.hasPrevious()) ? 'visible' : 'invisible'}">Previous</button>
        <span th:text="${'Page ' + pageNumber + ' of ' + page.totalPages}"></span>
        <button id="next-page" th:classappend="${(page.hasNext()) ? 'visible' : 'invisible'}">Next</button>
        <button id="last-page" th:classappend="${(pageNumber < page.totalPages) ? 'visible' : 'invisible'}">Last</button>
    </div>
</main>

<script th:inline="javascript">
    /*<![CDATA[*/
    const filterForm = document.getElementById("filter-form");

    document.getElementById('first-page').addEventListener('click', () => {
        filterForm.action = '/admin/reviews/list/1';
        filterForm.submit();
    });
    document.getElementById('previous-page').addEventListener('click', () => {
        filterForm.action = '/admin/reviews/list/' + [[${pageNumber - 1}]];
        filterForm.submit();
    });
    document.getElementById('next-page').addEventListener('click', () => {
        filterForm.action = '/admin/reviews/list/' + [[${pageNumber + 1}]];
        filterForm.submit();
    });
    document.getElementById('last-page').addEventListener('click', () => {
        filterForm.action = '/admin/reviews/list/' + [[${page.totalPages}]];
        filterForm.submit();
    });
    /*]]>*/
</script>
</body>
</html>
