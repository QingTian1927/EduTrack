<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Sign Up - EduTrack</title>

    <!-- Icons & Styles -->
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css}">
    <link rel="stylesheet" th:href="@{/assets/css/login.css}">
    <link rel="stylesheet" th:href="@{/assets/css/courselist.css}">

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body style="background-image: url('/assets/images/course-bg.png'); background-size: cover; background-position: center;">

<!-- Header Fragment -->
<th:block th:insert="~{fragments/header :: header}"></th:block>

<!-- Signup Form -->
<div class="login container grid" style="display: flex; justify-content: center; width: 100%; margin-top: 120px; padding-bottom: 4rem;" id="loginAccessRegister">
    <div class="login__access">
        <h1 class="login__title">Create new account.</h1>

        <div class="login__area">
            <form th:action="@{/signup}" method="post" th:object="${user}" class="login__form">
                <div class="login__content grid">

                    <div th:if="${error}" style="color: red;">[[${error}]]</div>

                    <div class="login__box">
                        <input type="text" th:field="*{fullName}" required placeholder=" " class="login__input">
                        <label class="login__label">Full Name</label>
                        <i class="ri-user-fill login__icon"></i>
                    </div>

                    <div class="login__group grid">
                        <div class="login__box">
                            <input type="date" th:field="*{birthDate}" required placeholder=" " class="login__input" id="birthDateInput" style="color: #9c9b9b">
                            <label class="login__label">Birth Date</label>
                        </div>

                        <div class="login__box" style="justify-content: space-between;">
                            <label style="margin: 0 10px; font-weight: 600;">Gender</label>
                            <label class="gender-option">
                                <input type="radio" th:field="*{gender}" value="male" hidden checked>
                                <span>Male</span>
                            </label>
                            <label class="gender-option">
                                <input type="radio" th:field="*{gender}" value="female" hidden>
                                <span>Female</span>
                            </label>
                        </div>
                    </div>

                    <div class="login__box">
                        <input type="text" th:field="*{phone}" required placeholder=" " class="login__input">
                        <label class="login__label">Phone</label>
                        <i class="ri-phone-fill login__icon"></i>
                    </div>

                    <div class="login__box">
                        <input type="email" th:field="*{email}" required placeholder=" " class="login__input">
                        <label class="login__label">Email</label>
                        <i class="ri-mail-fill login__icon"></i>
                    </div>

                    <div class="login__box">
                        <select name="role" class="login__input" style="height: auto; padding: 1.25rem;">
                            <option value="mentee">Mentee</option>
                            <option value="mentor">Mentor</option>
                        </select>
                        <label class="login__label" style="top: -1.5rem;">Role</label>
                    </div>

                    <div class="login__group grid">
                        <div class="login__box">
                            <input type="password" th:field="*{password}" required placeholder=" " class="login__input">
                            <label class="login__label">Password</label>
                            <i class="ri-eye-off-fill login__icon login__password" id="loginPassword"></i>
                        </div>
                        <div class="login__box">
                            <input type="password" name="confirm_password" id="confirm_password" required placeholder=" " class="login__input">
                            <label class="login__label">Repeat Password</label>
                        </div>
                    </div>

                    <div class="g-recaptcha" data-sitekey="6Ld2SkkrAAAAAPiQ0oOFQp1QvEd07wsehI43ObCR"></div>
                </div>

                <button type="submit" class="login__button">Create Account</button>
            </form>

            <div class="login__switch" style="display: flex; justify-content: center; align-items: center; gap: 0.75rem; font-size: 1.25rem; font-weight: 500; margin-top: 2rem;">
                <span style="color: #333;">Already have an account?</span>
                <a href="/login" style="color: #ff6b6b; font-weight: 700; font-size: 1.25rem; text-decoration: none;">Log In</a>
            </div>
        </div>
    </div>
</div>

<!-- Footer Fragment -->
<th:block th:insert="~{fragments/footer :: footer}"></th:block>

<!-- JavaScript Validation -->
<script>
    setInterval(() => grecaptcha.reset(), 120000);

    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector(".login__form");
        const fullNameInput = form.querySelector("[name='fullName']");
        const birthDateInput = document.getElementById("birthDateInput");
        const phoneInput = form.querySelector("[name='phone']");
        const emailInput = form.querySelector("[name='email']");
        const passwordInput = form.querySelector("[name='password']");
        const confirmPasswordInput = document.getElementById("confirm_password");

        form.addEventListener("submit", function (e) {
            const fullName = fullNameInput.value.trim();
            const birthDate = new Date(birthDateInput.value);
            const phone = phoneInput.value.trim();
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const today = new Date();

            if (!fullName) {
                alert("Full name is required");
                e.preventDefault(); return;
            }

            if (birthDate > today) {
                alert("Birth date cannot be in the future");
                e.preventDefault(); return;
            }

            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
            if (age < 6) {
                alert("You must be at least 6 years old to register");
                e.preventDefault(); return;
            }

            if (!/^\d{10,15}$/.test(phone)) {
                alert("Phone number must be between 10 and 15 digits");
                e.preventDefault(); return;
            }

            if (!/^\S+@\S+\.\S+$/.test(email)) {
                alert("Email format is invalid");
                e.preventDefault(); return;
            }

            if (password.length < 6) {
                alert("Password must be at least 6 characters");
                e.preventDefault(); return;
            }

            if (password !== confirmPassword) {
                alert("Passwords do not match");
                e.preventDefault(); return;
            }

            if (grecaptcha.getResponse().length === 0) {
                alert("Please verify reCAPTCHA");
                e.preventDefault(); return;
            }
        });
    });
</script>

</body>
</html>
