<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduTrack - CV Approval List</title>
    <link rel="stylesheet" th:href="@{/css/master.css}"/>
    <link rel="stylesheet" th:href="@{/css/colors.css}"/>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->

    <style>
        .page-header {
            font-size: 2.5em;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1em;
            padding: 0.5em;
        }

        .filter-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            grid-template-rows: auto auto;
            gap: 1em;
        }

        .filter-group {
            display: flex;
            justify-content: flex-start;
            gap: 0.5em;
        }

        .checkbox-group {
            grid-column: span 3;
            width: 100%;
            display: flex;
            justify-content: flex-start;
            flex-wrap: wrap;
            gap: 0.5em;
        }

        .cv-table {
            width: 100%;
            border-collapse: collapse;
        }

        .cv-table-header {
            background-color: var(--color-primary);
        }

        .cv-table th, .cv-table td {
            padding: 0.5em;
            border: 1px solid var(--color-secondary);
            text-align: left;
        }

        .cv-table tbody > tr:nth-child(odd) {
            background-color: var(--bg-primary);
        }

        .cv-table tbody > tr:nth-child(even) {
            background-color: var(--bg-modal);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5em;
        }

        .tag-item {
            background-color: var(--color-info);
            padding: 0.25em 0.5em;
            border-radius: 0.25em;
        }

        .pagination {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 0.5em;
        }

        .bg-approved {
            background-color: var(--color-success);
        }

        .bg-rejected {
            background-color: var(--color-error);
        }

        .bg-pending {
            background-color: var(--color-warning);
        }

        .visible {
            visibility: visible;
        }

        .invisible {
            visibility: hidden;
        }
    </style>
</head>
<body class="viewport">
<h1 class="page-header">CV Approval List</h1>
<main class="main-grid">
    <form class="filter-form" id="filter-form">
        <div class="filter-group">
            <h3 class="">
                <label for="sort">Sorting Order:</label>
            </h3>
            <select name="sort" id="sort">
                <option value="date-desc" th:selected="${sort != null && sort == 'date-desc' }">Date
                    descending
                </option>
                <option value="date-asc" th:selected="${sort != null && sort == 'date-asc' }">Date
                    ascending
                </option>
            </select>
        </div>

        <div class="filter-group">
            <h3 class="">Filter Options:</h3>
            <label for="pending">
                <input type="radio" name="filter" id="pending" value="pending"
                       th:checked="${filter != null && filter == 'pending'}">
                Pending
            </label>

            <label for="approved">
                <input type="radio" name="filter" id="approved" value="approved"
                       th:checked="${filter != null && filter == 'approved'}">
                Approved
            </label>

            <label for="rejected">
                <input type="radio" name="filter" id="rejected" value="rejected"
                       th:checked="${filter != null && filter == 'rejected'}">
                Rejected
            </label>
        </div>

        <button type="submit" class="">Filter</button>

        <div class="checkbox-group">
            <label>
                <input id="tags-all" type="checkbox" name="tags" value="all" th:checked="${#lists.contains(tags, 'all')}"/>
                <span>All</span>
            </label>

            <label th:each="skill : ${skills}">
                <input type="checkbox" name="tags" th:value="${skill}"
                       th:checked="${#lists.contains(tags, skill)}"/>
                <span th:text="${skill}"></span>
            </label>
        </div>
    </form>

    <table class="cv-table">
        <thead class="cv-table-header">
        <tr>
            <th>Status</th>
            <th>Created Date</th>
            <th>User</th>
            <th>Skills</th>
            <th>Education</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="cv : ${page.content}">
            <td th:text="${cv.status}"
                th:classappend="${cv.status.equals('approved') ? 'bg-approved' : (cv.status.equals('rejected') ? 'bg-rejected' : 'bg-pending')}"></td>
            <td th:text="${cv.createdDate.toLocaleString()}"></td>
            <td th:text="${cv.user.fullName}"></td>
            <td>
                <div class="tags">
                    <span th:each="skill : ${cv.getSkillItems()}" th:text="${skill}" class="tag-item"></span>
                </div>
            </td>
            <td>
                <div class="tags">
                    <span th:each="education : ${cv.getEducationItems()}" th:text="${education}"
                          class="tag-item"></span>
                </div>
            </td>
            <td>
                <a th:href="@{/admin/cv/detail/{id}(id = ${cv.id})}">View More</a>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="pagination">
        <button id="first-page" th:classappend="${(pageNumber > 1) ? 'visible' : 'invisible'}">
            First
        </button>

        <button id="previous-page" th:classappend="${(page.hasPrevious()) ? 'visible' : 'invisible'}">
            Previous
        </button>

        <span th:text="${'Page ' + pageNumber + ' of ' + page.totalPages}"></span>

        <button id="next-page" th:classappend="${(page.hasNext()) ? 'visible' : 'invisible'}">
            Next
        </button>

        <button id="last-page" th:classappend="${(pageNumber < page.totalPages) ? 'visible' : 'invisible'}">
            Last
        </button>
    </div>
</main>

<script th:inline="javascript">
    /*<![CDATA[*/
    const filterForm = document.getElementById("filter-form");

    document.getElementById('first-page').addEventListener('click', () => {
        filterForm.action = '/admin/cv/list/1';
        filterForm.submit();
    });
    document.getElementById('previous-page').addEventListener('click', () => {
        filterForm.action = '/admin/cv/list/' + [[${pageNumber - 1}]];
        filterForm.submit();
    });
    document.getElementById('next-page').addEventListener('click', () => {
        filterForm.action = '/admin/cv/list/' + [[${pageNumber + 1}]];
        filterForm.submit();
    });
    document.getElementById('last-page').addEventListener('click', () => {
        filterForm.action = '/admin/cv/list/' + [[${page.totalPages}]];
        filterForm.submit();
    });

    const allTagsCheckbox = document.getElementById('tags-all');
    const tagCheckboxes = document.querySelectorAll('input[name="tags"]');

    allTagsCheckbox.addEventListener('change', () => {
        tagCheckboxes.forEach(checkbox => {
            checkbox.checked = allTagsCheckbox.checked;
        });
    });
    /*]]>*/
</script>
</body>
</html>